(()=>{"use strict";function e(e,r){var n=document.cookie.replace(new RegExp("(?:(?:^|.*;\\s*)".concat(e,"\\s*\\=\\s*([^;]*).*$)|^.*$")),"$1");if(n=decodeURIComponent(n),r)try{n=JSON.parse(n)}catch(e){n=""}return n}function r(e,r,n,t){document.cookie="".concat(e,"=").concat(r,";max-age=").concat(60*n,";domain=").concat(t.cookieDomain,";path=").concat(t.cookiePath,";secure=true;samesite=lax")}function n(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function t(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}var o=["productDetailClick"];function a(){return!!e("tws_debug_sac")}function i(){if(a()){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];var t=[].slice.call(r);t.unshift("%c tws_session_calculator ","color: white; background: #c12b2b; font-weight: bold"),console.log.apply(this,t)}}function c(e){var r;r="string"==typeof e?JSON.parse(e):e;try{var n=r.predictions;return i("predictions: ",n),JSON.stringify(n[0])}catch(e){return i('CPP Response Error - invalid response. Expected {"predictions": [[number2, number2]]}. Is: ',r),i(e),!1}}function s(e){return!!e.visitorType&&"new"===e.visitorType.toLowerCase()}function u(e,r){try{return e.split("/")[r]||"(not set)"}catch(e){return"(not set)"}}function m(r,n){var t,a={};try{a={cm:n.medium,cs:n.source,nv:s(r),lpTime:r.pageHistory[0].time,lpCgOne:u(r.pageHistory[0].breadcrumb1,0),lpCgTwo:u(r.pageHistory[0].breadcrumb1,1),spTime:r.pageHistory[1].time,spCgOne:u(r.pageHistory[1].breadcrumb1,0),spCgTwo:u(r.pageHistory[1].breadcrumb1,1),spP:r.pageHistory[1].breadcrumb2.replace(/\.html$/,""),tpTime:r.pageHistory[2].time,tpCgOne:u(r.pageHistory[2].breadcrumb1,0),tpCgTwo:u(r.pageHistory[2].breadcrumb1,1),tpP:r.pageHistory[2].breadcrumb2.replace(/\.html$/,""),pdc:r[o[0]],cid:(t=e("_ga"),t?t.split(".").slice(-2).join("."):"")}}catch(e){i(e)}return a}function g(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function p(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?g(Object(n),!0).forEach((function(r){d(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function d(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function l(e,r){var n,t=new URL(r).searchParams.get("ccmp");if(!t)return n;var o=t.split(/_\d:/);return i("ccmp",o),o&&"medium"===e&&(n=o[6]),o&&"source"===e&&(n="".concat(o[4]," / ").concat(o[5])),n}const f=function(e){var r={},n=window.location.href;return e&&(r=function(e){var r=e;return e.breadcrumb2&&!e.currentURL&&(r.currentURL=e.breadcrumb2,r.breadcrumb2=new URL(e.breadcrumb2).pathname),r}(e)),r.currentURL&&(n=r.currentURL),p(p(p({},function(e){var r,n=e;window&&window.utag_data["dom.url"]&&(n=window.utag_data["dom.url"]);try{n=new URL(n)}catch(e){n=new URL(window.location.href)}return{breadcrumb1:(r=window.utag_data||{},"".concat(r.page_category_01,"/").concat(r.page_category_02)),breadcrumb2:window.location.pathname,referrerHostname:document.referrer?new URL(document.referrer).hostname:"",utm_source:n.searchParams.get("utm_source")||l("source",e)||"",utm_medium:n.searchParams.get("utm_medium")||l("medium",n)||"",gclid:n.searchParams.get("gclid")||"",msclkid:n.searchParams.get("msclkid")||"",dclid:n.searchParams.get("dclid")||"",currentTimestamp:Math.round((new Date).getTime()/1e3)}}(n)),{maxNumberOfPagesToTrack:3,referralExclusionList:["coop.ch","payment.datatrans.biz","pilot.datatrans.biz","epayment.postfinance.ch","paypal.com","pay.datatrans.com","login.supercard.ch","datatrans.com","supercard.ch","datatrans.biz","survey-innofact.ch","tradedoubler.com"],cookieDomain:"coop.ch",eventNamesToCountInSession:["productDetailClick"],eventNamesToCountPageview:["pageview"],cookiePath:"/",sessionDurationInMin:30,GAcampaignTimeoutInHours:720,cookieNameSession:"tws_session",cookieNameCampaign:"tws_camp",visitorTypeBuffer:15}),r)};var b=[{regex:/^(www.)?google./,name:"google"},{regex:/bing\./,name:"bing"},{regex:/yahoo\./,name:"yahoo"},{regex:/duckduckgo\./,name:"duckduckgo"},{regex:/lilo\.org/,name:"lilo.org"},{regex:/ecosia\.org/,name:"ecosia.org"},{regex:/yandex\.ru/,name:"yandex"},{regex:/^(www\.)?yandex\.com/,name:"yandex"},{regex:/^(www\.)?qwant\.com/,name:"qwant.com"},{regex:/^(www\.)?ask\.com/,name:"ask"},{regex:/search\.aol\.fr/,name:"ask"},{regex:/alicesuche\.aol\.de/,name:"ask"},{regex:/^(www\.)?baidu\.com/,name:"baidu"},{regex:/search\.virgilio\.it/,name:"virgilio"},{regex:/^(www\.)?aol\.com/,name:"aol"},{regex:/^(www\.)?naver\.com/,name:"naver"},{regex:/search\.ukr\.net/,name:"ukr"},{regex:/de\.search\.yahoo\.com/,name:"de.search.yahoo.com"},{regex:/^(www\.)?yahoo\.com/,name:"yahoo"},{regex:/m\.yahoo\.com/,name:"yahoo"},{regex:/yahoo\.cn/,name:"yahoo"}];const w=function(e){for(var r=0,n=b.length;r<n;r+=1)if(b[r].regex.test(e))return b[r].name;return!1};function v(e,r){for(var n=e.referralExclusionList,t=n.length,o=0;o<t;o+=1)if(r.indexOf(n[o])>-1)return i("on ReferralExclusionList, referrer:",r,"list entry:",n[o]),!0;return i("NOT on ReferralExclusionList, referrer:",r),!1}function y(r){var n,t=e(f(r).cookieNameCampaign,!0);return(n=t)&&n.medium&&n.source||(i("INVALID or no campaign cookie detected using fallback.",t),t={medium:"(none)",source:"(direct)"}),i("campaign cookie read:",t),t}function h(r){var n=e("_ga",!1).split("."),t="New";return 4===n.length&&r.currentTimestamp-n[3]>=r.visitorTypeBuffer&&(t="Returning"),i("visitorType detected as",t,"ga timestamp:",n[3],"current time",r.currentTimestamp),t}function O(e){var r=y(e),n=function(e){var r="(direct)",n=e.utm_source,t=e.gclid,o=e.msclkid,a=e.dclid,c=e.referrerHostname;return n?r=n:t?r="google":a?r="dfa":c&&!v(e,c)?r=function(e){var r=w(e);if(r)return i("hostname identified as google analytics search engine.",e,r),r;if(/[A-Za-z]*facebook\.[[A-Za-z]+/.test(e))return"facebook";var n=e.match(/www\.(\w+.+)/);return n&&n.length>=2?n[1]:e}(c):o&&(r="bing"),i("Current source detected as",r),r}(e),t={medium:function(e){var r="(none)",n=e.utm_medium,t=e.gclid,o=e.msclkid,a=e.dclid,c=e.referrerHostname;return n?r=n:t||o?r="cpc":a?r="cpm":w(c)?r="organic":/facebook\.|instagram\.|pinterest\./.test(c)?r="social":c&&!v(e,c)&&(r="referral"),i("Current Medium detected as",r),r}(e),source:n};return"(direct)"===n&&(t.medium="(none)",r&&r.medium&&(t.medium=r.medium),r&&r.source&&(t.source=r.source)),n&&"(none)"!==n&&"(direct)"!==n||(t=r,i("not updating campaign data, because source is direct or considered not set, returning old data: ",r)),i("campaign infos calculated:",t),t}function k(e,n){var t=encodeURIComponent(JSON.stringify(n));r(e.cookieNameSession,t,e.sessionDurationInMin,e),i("session info stored in cookie",e.cookieNameSession,n,e)}function P(r){var n=e(f(r).cookieNameSession,!0);return n&&i("found existing session: ",n),n||i("no existing session found."),n}function N(e,n){i("SESSION INIT: ",e,n);var t=P(n),o=f(n),a=O(o),c=function(e,r,n){var t=y(e),o="Fallback: no case fitted.",a=!1;return r?n.medium===t.medium&&n.source===t.source||(a=!0,o="campaign information changed."):(a=!0,o="no session cookie found or empty or page counter = 0."),i("Session detected as",a?"new":"continued","because",o,"event:",e.triggerEventName),a}(o,t,a);return o.triggerEventName=e,Object.prototype.hasOwnProperty.call(t,"calcToggle")&&!1===t.calcToggle&&!c?(i("session calculation toggle is false and no need to restart the session. Won't do anything. To activate use setSessionValue()."),!1):(t&&!c||(t=function(e){i("initiating new session",JSON.parse(JSON.stringify(e)));for(var r={pageCount:0,calcToggle:!0,cv:"",pageHistory:[],visitorType:h(e)},n=0;n<e.eventNamesToCountInSession.length;n+=1)r[e.eventNamesToCountInSession[n]]=0;return r}(o)),k(o,t=function(e,r){var n=r;return e.eventNamesToCountInSession.indexOf(e.triggerEventName)>-1?(n[e.triggerEventName]+=1,i("setting ".concat(e.triggerEventName," counter +1"),e.eventNamesToCountInSession),n):(e.eventNamesToCountPageview.indexOf(e.triggerEventName)>-1&&(n.pageCount+=1,i("setting page counter +1 for current path:",e.currentURL,e.triggerEventName,"=",e.eventNamesToCountPageview,e.eventNamesToCountInSession),n=function(e,r){return r.pageHistory.length===e.maxNumberOfPagesToTrack?(i("not pushing state because max pageHistory reached"),r):-1===e.eventNamesToCountPageview.indexOf(e.triggerEventName)?(i("not pushing state because event is not acceptable pageview"),r):(i("pushing page history to session:",e.breadcrumb1,e.breadcrumb2,e.triggerEventName,e.eventNamesToCountPageview),r.pageHistory.push({breadcrumb1:e.breadcrumb1,breadcrumb2:e.breadcrumb2,time:e.currentTimestamp}),r)}(e,n)),n)}(o,t)),function(e,n){var t=encodeURIComponent(JSON.stringify(n));r(e.cookieNameCampaign,t,60*e.GAcampaignTimeoutInHours,e),i("campaign info stored in cookie",e.cookieNameCampaign,n)}(o,a),t.pageCount<o.maxNumberOfPagesToTrack&&t.pageCount!==t.pageHistory.length&&i("something is wrong with page count and page history: pageCount != No of pages in History."),t)}if(window.initCpp=function(e){var r=N("pageview",e);r&&3===r.pageCount&&(i("requesting prediction value"),function(e,r){var o=new XMLHttpRequest;o.open("POST","https://europe-west1-coop-marketinghub-prod1.cloudfunctions.net/conversion_probability_prediction",!0),o.setRequestHeader("Content-Type","application/json"),o.onreadystatechange=function(){return o.readyState===XMLHttpRequest.DONE&&(200!==o.status?(i("CPP Response Error - server response:",o.status,o.response),!1):!1===c(o.response)?(i("CPP Response Error - invalid response body",o.response),!1):(i("CPP: data received.",o.response),void function(e,r){var o={event_attributes_eventName:"Probability Event",event_category:"Conversion Probability",event_action:e,event_label:JSON.stringify(function(e){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?n(Object(o),!0).forEach((function(r){t(e,r,o[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(o,r))}))}return e}({},r)),probability_value:JSON.parse(e)[1]};window.utag.link(o),i("CPP Success: dataLayer push",o)}(c(o.response),r)))};try{o.send(JSON.stringify(r)),i("CPP: data sent, waiting for response.",r)}catch(e){i(e)}}(0,m(r,y(e))),function(e,r,n){var t=["calcToggle","cv"];if(-1===t.indexOf(e))return i("Session value can not be set, only allowed props:",t),!1;var o=P(n),a=f(n);o[e]=!1,k(a,o)}("calcToggle",0,e))},window.initCppDetailClick=function(e){N("productDetailClick",e)},window.initRefreshCppSession=function(e){var n,t,o,a;o=f(n=e),t=o.cookieNameSession,a=document.cookie.replace(new RegExp("(?:(?:^|.*;\\s*)".concat(t,"\\s*\\=\\s*([^;]*).*$)|^.*$")),"$1"),r(o.cookieNameSession,a,o.sessionDurationInMin,o),i("Session refreshed 🥶",n,o)},void 0!==window.cppQueue&&window.cppQueue instanceof Array)for(var C=0;C<window.cppQueue.length;C+=1){var x=window.cppQueue.shift();window.initCpp(x)}})();